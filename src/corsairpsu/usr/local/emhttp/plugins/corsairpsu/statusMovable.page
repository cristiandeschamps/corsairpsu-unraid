Menu="Dashboard:0"
Cond="parse_ini_file('/tmp/corsairpsu/config/corsairpsu.cfg')['DASH'] == 'enabled' && version_compare(parse_ini_file('/etc/unraid-version')['version'],'6.12.0-beta6', '<')"
Icon="ups"
---

<?PHP
/*
  Create a .page file based on this example file and store the file in your plugin directory
  Make sure this file has a unique name not used by the GUI or other plugins

  This is an example configuration which is used to add custom tiles to the dashboard
  Placement of one or more custom tiles is done under column1, column2 or column3
  A column can have as many new custom tiles as needed, each custom tile is a <tbody> element
  Each tile must have these two properties set:

  "_(description)_"    - this is the (translated) description shown in the Content Manager window
  "_(Tile tile)_"      - this is the (translated) title of the tile shown in bold on the screen

  The content of the tile can be any text as required by your plugin, this content is placed inside the <td> element
  A number of predefined spans are available to make fields of certain widths and maybe used to follow the GUI alignment
  These are:
  <span class="w18">
  <span class="w26">
  <span class="w36">
  <span class="w44">
  <span class="w72">
*/

$pluginname = "corsairpsu"; // substitute this entry with the name of your plugin

$mytiles[$pluginname]['column2'] =
<<<EOT
<tbody id="tblcorsairpsu" title="(Corsair PSU)">
<tr><td><i class='icon-ups f32'></i>
<div class='section'>(Corsair PSU)<br>
<span class="corsair-vendor"></span> <span class="corsair-product"></span> (<span class="corsair-capacity"></span>W)
<span id="util">Utilization: <span class="corsair-load"></span>% (<span class="corsair-watts"></span>W)</span>
</span>
</div>
<a href="/Dashboard/Settings/CorsairPSUSettings" title="(Go to Corsair PSU settings)"><i class="fa fa-fw fa-cog control"></i></a></td></tr>
</tbody>
EOT;
?>

<table id="db-box1" class="dash_corsairpsu dashboard box1" style="display:none">
    <thead sort="965" class="sortable">
        <tr>
            <td></td>
            <td class="next dash_corsairpsu_header" colspan="3">
                <i class="icon-ups"></i>
                <div class="section dash_corsairpsu_section">Power Supply
                    <br>
                    <span class="corsair-vendor"></span> <span class="corsair-product"></span> (<span class="corsair-capacity"></span>W)
                    <span id="util">Utilization: <span class="corsair-load"></span>% (<span class="corsair-watts"></span>W)</span>
                    </span>
                    <br>
                </div>
                <i class="fa fa-fw chevron mt0" id="dash_corsairpsu_toggle" onclick="toggleChevron('dash_corsairpsu_toggle',0)"></i>
                <a href="/Settings/CorsairPSUSettings" id="dash_corsairpsu_settings" title="Go to Corsair PSU settings"><i class="fa fa-fw fa-cog chevron mt0"></i></a>
            </td>
            <td></td>
        </tr>
    </thead>
    <tbody class="dash_corsairpsu_toggle sortable" sort="965">
        <tr>
            <td></td>
            <td><span class="header dash_corsairpsu_table_header">12v Utilization</span></td>
            <td><span class="header dash_corsairpsu_table_header">5v Utilization</span></td>
            <td><span class="header dash_corsairpsu_table_header">3v Utilization</span></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td><span class="corsair-12v_load"></span>% (<span class="corsair-12v_watts"></span>W) </td>
            <td><span class="corsair-5v_load"></span>% (<span class="corsair-5v_watts"></span>W)</td>
            <td><span class="corsair-3v_load"></span>% (<span class="corsair-3v_watts"></span>W)</td>
            <td></td>
        </tr>
        <tr><td colspan="5"></td></tr><tr><td colspan="5"></td></tr>
        <tr class="corsair-temp-rm">
            <td></td>
            <td>Temperature / Fan</td>
            <td><span class="corsair-temp1"></span> / <span class="corsair-temp2"></span> °c</td>
            <td><span class="corsair-fan_rpm"></span> RPM</td>
            <td></td>
        </tr>
        <tr class="corsair-temp-ax">
            <td></td>
            <td>Temperature / Fan</td>
            <td><span class="corsair-temp1"></span> °c</td>
            <td><span class="corsair-fan_rpm"></span> RPM</td>
            <td></td>
        </tr>
        <tr class="corsair-uptime-rm">
            <td></td>
            <td>Uptime</td>
            <td><span class="corsair-uptime"></span></td>
            <td><span class="corsair-poweredon"></span> Total</td>
            <td></td>
        </tr>
        <tr class="corsair-efficiency-ax">
            <td></td>
            <td>Efficiency / Supply</td>
            <td><span class="corsair-efficiency"></span>% (<span class="corsair-input_power"></span>W)</span></td>
            <td><span class="corsair-input_voltage"></span>V</td>
            <td></td>
        </tr>
    </tbody>
</table>
<script>
const corsairpsu_status = () => {
    $.getJSON("/plugins/corsairpsu/status.php", (data) => {
        if (data) {
         $.each(data, function (key, data) {
             $(".corsair-" + key).html(data);
         })
        }
    });
};
$(corsairpsu_status);
if (<?=$corsairpsu_cfg['UIREFRESH'];?>) {
    setInterval(corsairpsu_status, <?=max(abs($display['refresh']), $corsairpsu_cfg['UIREFRESHINT']);?>);
}

$(function() {
  // append data from the table into the correct one
  $("#db-box1").append($(".dash_corsairpsu").html());
  
  // reload toggle to get the correct state
  toggleView('dash_corsairpsu_toggle',true);
  
  // reload sorting to get the stored data (cookie)
  sortTable($('#db-box1'),$.cookie('db-box1'));
});
</script>
